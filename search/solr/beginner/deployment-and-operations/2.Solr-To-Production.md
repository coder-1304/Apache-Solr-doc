# Requirements: 

- You need 2n+1 servers to survive n faliures

**Sever resources:**
- Use SSDs if you can (disk throughput is important)
- 8 CPU cores or better


**Zookeeper:**
- in the bin/solr.in.cmd file we define list of zookeepers in the `REM set ZK_HOST=` via zookeeper hosts seperated by `,`.

# Fine-Tune Your Production Setup

## Dynamic Defaults for ConcurrentMergeScheduler

**Merge Scheduler**
- In Solr, when data is indexed, it's stored in small segments. Periodically, these segments need to be merged to optimize search performance.
- The default method for managing these merges is called ConcurrentMergeScheduler, which uses multiple threads to merge segments in the background.

**Dynamic Defaults**
- The behavior of ConcurrentMergeScheduler can be customized in the Solr configuration file (`solrconfig.xml`).
- By default, this scheduler adjusts its settings based on whether your storage drive is a traditional hard disk (rotational) or a solid-state drive (SSD).

**Auto-Detection**
- If your drive is rotational (like a traditional hard disk), the scheduler limits the number of threads used for merging to 1 and the maximum number of merges to 6, to prevent performance issues.
- If your drive is an SSD or non-rotational, it sets the number of threads to 4 or half the number of CPU cores available to Solr (whichever is greater), and adjusts the maximum number of merges accordingly.

**Platform Limitations**
- The auto-detection feature works reliably only on Linux systems. On other platforms, drives are assumed to be rotational, potentially leading to incorrect settings.
- Incorrect settings can severely impact indexing performance, causing slower operations.

**Manual Configuration**
- To ensure optimal performance, it's recommended to manually set the values for `maxThreadCount` and `maxMergeCount` in the Solr configuration file based on your hardware specifications.
- This way, you can override the auto-detected defaults and tailor the settings to match your specific hardware setup.

**Override Options**
- If needed, you can override the auto-detected values using system properties.
- For example, you can set `lucene.cms.override_spins` to `true/false` to force rotational/non-rotational disk detection, or `lucene.cms.override_core_count` to specify the number of CPU cores manually.


## Memory and GC Settings

By default, the `bin/solr` script sets the maximum Java heap size to 512M (`-Xmx512m`), suitable for initial Solr setup. For production, adjust the maximum heap size based on your application's memory needs. Typically, values between 8 and 16 gigabytes are used for production servers. To modify memory settings, use the `SOLR_HEAP` variable in the include file:

```bash
SOLR_HEAP="8g"
```

Avoid allocating a very large Java heap unless necessary. 

Additionally, the Solr Control Script includes pre-configured Garbage First Garbage Collection settings known to work well with Solr for various workloads. However, these settings may not suit your specific Solr usage. Adjust the GC settings using the GC_TUNE variable in the /etc/default/solr.in.sh include file.
